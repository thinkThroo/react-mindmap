{"version":3,"file":"main.es.js","sources":["../../../packages/core/src/types/index.ts","../../../packages/core/src/models/block.ts","../../../packages/core/src/configs/theme/types.ts","../../../packages/core/src/configs/theme/default-theme.ts","../../../packages/core/src/models/config.ts","../../../packages/core/src/models/topic.ts","../../../packages/core/src/models/desc-block-data.ts","../../../packages/core/src/models/utils/index.ts","../../../packages/core/src/utils/index.ts","../../../packages/core/src/models/sheet-model-modifier.ts","../../../packages/core/src/models/doc-model-modifier.ts","../../../packages/core/src/models/sheet-model.ts","../../../packages/core/src/models/doc-model.ts","../../../packages/core/src/plugins/core.ts","../../../packages/core/src/controller.ts"],"sourcesContent":["import { DocModel } from '../models';\n\nexport type KeyType = string;\n\nexport type KeyPath = KeyType[];\n\nexport const TopicDirection = {\n  LEFT: 'L', // 从右向左\n  RIGHT: 'R', // 从左向右\n  BOTTOM: 'B', // 从上往下\n  MAIN: 'M' // root\n};\n\nexport enum DiagramLayoutType {\n  LEFT_TO_RIGHT,\n  RIGHT_TO_LEFT,\n  LEFT_AND_RIGHT,\n  TOP_TO_BOTTOM\n}\n\nexport const ViewModeMindMap = 'MindMap';\n\nexport const TopicVisualLevel = {\n  ROOT: 0,\n  PRIMARY: 1,\n  NORMAL: 2\n};\n\nexport const BlockType = {\n  CONTENT: 'CONTENT',\n  DESC: 'DESC'\n};\n\nexport const FocusMode = {\n  NORMAL: 'NORMAL',\n  EDITING_CONTENT: 'EDITING_CONTENT',\n  EDITING_DESC: 'EDITING_DESC',\n  SHOW_POPUP: 'SHOW_POPUP',\n  DRAGGING: 'DRAGGING'\n};\n\nexport type ModelChangeCallback = () => void;\n\nexport type OnChangeFunction = (\n  model: DocModel,\n  callback?: ModelChangeCallback\n) => void;\n\nexport const TopicRelationship = {\n  ANCESTOR: 'ANCESTOR',\n  DESCENDANT: 'DESCENDANT',\n  SIBLING: 'SIBLING',\n  NONE: 'NONE'\n};\n\nexport const OpType = {\n  ADD_SHEET: 'ADD_SHEET',\n  SET_CURRENT_SHEET: 'SET_CURRENT_SHEET',\n  DELETE_SHEET: 'DELETE_SHEET',\n  DUPLICATE_SHEET: 'DUPLICATE_SHEET',\n  SET_SHEET_TITLE: 'SET_SHEET_TITLE',\n\n\n  ADD_MULTI_TOPICS: 'ADD_MULTI_TOPICS',\n  ADD_MULTI_SIBLING: 'ADD_MULTI_SIBLING',\n  ADD_MULTI_CHILD: 'ADD_MULTI_CHILD',\n  ADD_MULTI_CHILD_WITH_EXTDATA: 'ADD_MULTI_CHILD_WITH_EXTDATA',\n\n  TOGGLE_COLLAPSE: 'TOGGLE_COLLAPSE',\n  COLLAPSE_ALL: 'COLLAPSE_ALL',\n  EXPAND_ALL: 'EXPAND_ALL',\n  EXPAND_TO: 'EXPAND_TO',\n  ADD_CHILD: 'ADD_CHILD',\n  ADD_SIBLING: 'ADD_SIBLING',\n  TOPIC_CONTENT_TO_PLAIN_TEXT: 'TOPIC_CONTENT_TO_PLAIN_TEXT',\n  INDENT: 'INDENT',\n  OUTDENT: 'OUTDENT',\n  DELETE_TOPIC: 'DELETE_TOPIC',\n  FOCUS_TOPIC: 'FOCUS_TOPIC',\n  SET_FOCUS_MODE: 'SET_FOCUS_MODE',\n  SET_STYLE: 'SET_STYLE',\n  CLEAR_ALL_CUSTOM_STYLE: 'CLEAR_ALL_CUSTOM_STYLE',\n  SET_CONFIG: 'SET_CONFIG',\n  SET_THEME: 'SET_THEME',\n  SET_TOPIC_BLOCK: 'SET_TOPIC_BLOCK',\n  DELETE_TOPIC_BLOCK: 'DELETE_TOPIC_BLOCK',\n  // 节流函数使用，使用时不可以undo\n  SET_TOPIC_BLOCK_CONTENT: 'SET_TOPIC_BLOCK_CONTENT',\n  // SET_TOPIC_BLOCK_DESC: 'SET_TOPIC_BLOCK_DESC',\n  // DELETE_TOPIC_BLOCK_DESC: 'DELETE_TOPIC_BLOCK_DESC',\n  // SET_TOPIC_CONTENT: 'SET_TOPIC_CONTENT',\n  // SET_TOPIC_DESC: 'SET_TOPIC_DESC',\n  START_EDITING_CONTENT: 'START_EDITING_CONTENT',\n  START_EDITING_DESC: 'START_EDITING_DESC',\n  DRAG_AND_DROP: 'DRAG_AND_DROP',\n  SET_EDITOR_ROOT: 'SET_EDITOR_ROOT',\n  SET_LAYOUT_DIR: 'SET_LAYOUT_DIR',\n  SWAP_UP: 'SWAP_UP',\n  SWAP_DOWN: 'SWAP_DOWN'\n};\n","import { List, Record } from 'immutable';\nimport { KeyType } from '../types';\n\ntype BlockRecordType = {\n  type: string;\n  key?: KeyType;\n  data: any;\n};\n\nconst defaultBlockRecord: BlockRecordType = {\n  type: null,\n  key: null,\n  data: null\n};\n\nexport class Block extends Record(defaultBlockRecord) {\n  get data(): any {\n    return this.get('data');\n  }\n\n  get type(): string {\n    return this.get('type');\n  }\n\n  static create(obj: BlockRecordType): Block {\n    return new Block(obj);\n  }\n\n  static createList(obj: any): List<Block> {\n    if (List.isList(obj) || Array.isArray(obj)) {\n      // @ts-ignore\n      return List(obj.map(Block.create));\n    }\n    throw new Error(\n      `Block.createList only accepts Array or List, but you passed it: ${obj}`\n    );\n  }\n}\n","export type LinkLineType = 'line' | 'curve' | 'round';\nexport type LinkStyle = {\n  lineType?: string;\n  hasUnderline?: boolean;\n  lineWidth?: string;\n  lineColor?: string;\n  lineRadius?: number;\n};\n\nexport type TopicContentStyle = {\n  [key: string]: any;\n  background?: string;\n  color?: string;\n  fontFamily?: string;\n  fontSize?: string;\n  lineHeight?: string;\n  border?: string;\n  borderRadius?: string;\n  borderWidth?: string;\n  borderStyle?: string;\n  borderColor?: string;\n  padding?: string;\n};\n\nexport type TopicStyle = {\n  contentStyle?: TopicContentStyle;\n  linkStyle?: LinkStyle;\n  subLinkStyle?: LinkStyle;\n};\n\nexport type ThemeType = {\n  name: string;\n  background: string;\n  highlightColor: string;\n  randomColor?: boolean;\n  marginH: number;\n  marginV: number;\n\n  contentStyle?: TopicContentStyle;\n  linkStyle?: LinkStyle;\n\n  rootTopic?: TopicStyle;\n  primaryTopic?: TopicStyle;\n  normalTopic?: TopicStyle;\n};\n\nexport function isThemeType(obj: any): boolean {\n  return (\n    obj.name != null && obj.background != null && obj.highlightColor != null\n  );\n}\n\nexport interface Themes {\n  [fieldName: string]: ThemeType;\n}\n","import { ThemeType } from './types';\n\nexport const defaultTheme: ThemeType = {\n  name: 'defaultTheme',\n  randomColor: false,\n  background: '#DDDDDD',\n  highlightColor: '#C31004',\n  marginH: 50,\n  marginV: 5,\n  contentStyle: {\n    lineHeight: '1'\n  },\n\n  linkStyle: {\n    lineRadius: 5,\n    lineWidth: '2px',\n    lineColor: '#595959',\n    lineType: 'curve'\n  },\n\n  rootTopic: {\n    contentStyle: {\n      background: '#C31004',\n      color: '#fff',\n      fontSize: '34px',\n      borderRadius: '5px',\n      padding: '16px 18px 16px 18px'\n    },\n    subLinkStyle: {\n      lineType: 'curve'\n    }\n  },\n  primaryTopic: {\n    contentStyle: {\n      background: '#333',\n      borderRadius: '5px',\n      color: '#fff',\n      fontSize: '14px',\n      padding: '6px 10px 5px 10px'\n    },\n\n    subLinkStyle: {\n      hasUnderline: true,\n      lineType: 'round'\n    }\n  },\n\n  normalTopic: {\n    contentStyle: {\n      borderRadius: '5px',\n      background: '#fff0',\n      color: '#383833',\n      fontSize: '13px',\n      padding: '1px'\n    },\n\n    subLinkStyle: {\n      hasUnderline: true,\n      lineType: 'round'\n    }\n  }\n};\n","import { Record } from 'immutable';\nimport { defaultTheme, ThemeType } from '../configs/theme';\nimport { DiagramLayoutType, ViewModeMindMap } from '../types';\n\nexport type ConfigRecordType = {\n  viewMode: string;\n  readOnly?: boolean;\n  allowUndo?: boolean;\n  layoutDir?: DiagramLayoutType;\n  theme?: ThemeType;\n};\n\nconst defaultConfigRecord: ConfigRecordType = {\n  viewMode: ViewModeMindMap,\n  readOnly: false,\n  allowUndo: true,\n  layoutDir: DiagramLayoutType.LEFT_TO_RIGHT,\n  theme: defaultTheme\n};\n\nexport class Config extends Record(defaultConfigRecord) {\n  get viewMode(): string {\n    return this.get('viewMode');\n  }\n\n  get layoutDir(): DiagramLayoutType {\n    return this.get('layoutDir');\n  }\n\n  get readOnly(): boolean {\n    return this.get('readOnly');\n  }\n\n  get allowUndo(): boolean {\n    return this.get('allowUndo');\n  }\n\n  get theme(): ThemeType {\n    return this.get('theme');\n  }\n\n  static fromJSON(obj) {\n    return new Config(obj);\n  }\n}\n","import { List, Record } from 'immutable';\nimport { BlockType, KeyType } from '../types';\nimport { Block } from './block';\nimport { Relation } from './relation';\n\ntype TopicRecordType = {\n  key: KeyType;\n  parentKey?: KeyType;\n  collapse?: boolean;\n  subKeys?: List<KeyType>;\n  blocks?: List<Block>;\n  relations?: List<Relation>;\n  style?: string;\n};\n\ntype CreateTopicArg = {\n  key: KeyType;\n  parentKey?: KeyType;\n  collapse?: boolean;\n  content?: any;\n  subKeys?: List<KeyType> | KeyType[];\n  style?: string;\n};\n\nconst defaultTopicRecord: TopicRecordType = {\n  key: null,\n  parentKey: null,\n  collapse: false,\n  subKeys: null,\n  blocks: null,\n  relations: null,\n  style: null\n};\n\nexport class Topic extends Record(defaultTopicRecord) {\n  get key() {\n    return this.get('key');\n  }\n  get parentKey() {\n    return this.get('parentKey');\n  }\n  get collapse() {\n    return this.get('collapse');\n  }\n  get subKeys(): List<KeyType> {\n    return this.get('subKeys');\n  }\n  get blocks(): List<Block> {\n    return this.get('blocks');\n  }\n  get relations() {\n    return this.get('relations');\n  }\n  get style() {\n    return this.get('style');\n  }\n\n  getBlock(type: string): { index: number; block: Block } {\n    const index = this.blocks.findIndex(b => b.type === type);\n    if (index === -1) return { index, block: null };\n    return { index, block: this.blocks.get(index) };\n  }\n\n  get contentData() {\n    return this.getBlock(BlockType.CONTENT).block.data;\n  }\n\n  static fromJSON(obj) {\n    const {\n      key,\n      parentKey = null,\n      blocks,\n      subKeys = [],\n      collapse = false\n    } = obj;\n    return new Topic({\n      key,\n      parentKey,\n      collapse,\n      subKeys: List(subKeys),\n      blocks: Block.createList(blocks)\n    });\n  }\n\n  static create({\n    key,\n    parentKey = null,\n    content = '',\n    subKeys = [],\n    collapse = false\n  }: CreateTopicArg): Topic {\n    const block = Block.create({\n      type: BlockType.CONTENT,\n      data: content,\n      key: null\n    });\n    const blocks = List([block]);\n    return new Topic({\n      key,\n      parentKey,\n      blocks,\n      subKeys: List(subKeys),\n      collapse\n    });\n  }\n}\n","import { Record } from 'immutable';\n\ntype DescBlockDataRecordType = {\n  kind: string;\n  data: any;\n  collapse: boolean;\n};\n\nconst defaultDescBlockDataRecord: DescBlockDataRecordType = {\n  kind: null,\n  data: null,\n  collapse: false\n};\n\nexport class DescBlockData extends Record(defaultDescBlockDataRecord) {\n  get kind() {\n    return this.get('kind');\n  }\n\n  get data() {\n    return this.get('data');\n  }\n\n  get collapse() {\n    return this.get('collapse');\n  }\n}\n","import { KeyPath, KeyType, TopicRelationship } from '../../types';\nimport { SheetModel } from '../sheet-model';\n\nexport function getAllSubTopicKeys(\n  model: SheetModel,\n  topicKey: KeyType\n): KeyType[] {\n  const item = model.getTopic(topicKey);\n\n  let res = [];\n  if (item.subKeys.size > 0) {\n    const subKeys = item.subKeys.toArray();\n    res.push(...subKeys);\n    res = subKeys.reduce((acc, key) => {\n      acc.push(...getAllSubTopicKeys(model, key));\n      return acc;\n    }, res);\n  }\n  return res;\n}\n\nexport function getKeyPath(\n  model: SheetModel,\n  topicKey: KeyType,\n  reverse: boolean = false\n): KeyPath {\n  const res = [topicKey];\n  let item = model.getTopic(topicKey);\n  while (item.parentKey) {\n    reverse ? res.push(item.parentKey) : res.unshift(item.parentKey);\n    item = model.getParentTopic(item.key);\n  }\n  return res;\n}\n\nexport function getRelationship(\n  model: SheetModel,\n  srcKey: KeyType,\n  dstKey: KeyType\n): string {\n  const srcTopic = model.getTopic(srcKey);\n  const dstTopic = model.getTopic(dstKey);\n  if (srcTopic && dstTopic) {\n    if (srcTopic.parentKey == dstTopic.parentKey)\n      return TopicRelationship.SIBLING;\n    let pTopic = srcTopic;\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === dstTopic.key)\n        return TopicRelationship.DESCENDANT;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n    pTopic = dstTopic;\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === srcTopic.key) return TopicRelationship.ANCESTOR;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n  }\n  return TopicRelationship.NONE;\n}\n\nexport function getPrevTopicKey(model: SheetModel, topicKey: KeyType) {\n  const parentTopic = model.getParentTopic(topicKey);\n  if (parentTopic) {\n    const index = parentTopic.subKeys.indexOf(topicKey);\n    if (index === 0) {\n      return parentTopic.key;\n    }\n    return parentTopic.subKeys.get(index - 1);\n  }\n  return null;\n}\n\nexport function getNextTopicKey(model: SheetModel, topicKey: KeyType) {}\n\n// 判断该topic是否为其父亲的第一个孩子\nexport function isFisrtChild(model: SheetModel, topicKey: KeyType) {\n  const parentTopic = model.getParentTopic(topicKey);\n  if (parentTopic) {\n    const index = parentTopic.subKeys.indexOf(topicKey);\n    if (index === 0) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function isSibling(\n  model: SheetModel,\n  key1: KeyType,\n  key2: KeyType\n): boolean {\n  return model.getParentTopic(key1) === model.getParentTopic(key2);\n}\n\n/**\n * 根据当前元素的Key,获取depth=depth的祖先的key\n * @param model\n * @param key\n * @param depth\n */\nexport function getAncestorKeyByDepth(\n  model: SheetModel,\n  key: KeyType,\n  depth: number\n) {\n  let curDepth = model.getDepth(key);\n  if (curDepth === depth) return key;\n  if (curDepth < depth) return null;\n  while (curDepth > depth) {\n    key = model.getParentKey(key);\n    curDepth--;\n  }\n  return key;\n}\n\n/**\n * 找到他们互为sibling的祖先的Key,返回一个数组里面有两个祖先的key\n * @param model\n * @param key1\n * @param key2\n */\nexport function getSiblingAncestorKeys(\n  model: SheetModel,\n  key1: KeyType,\n  key2: KeyType\n): Array<KeyType> {\n  const d1 = model.getDepth(key1);\n  const d2 = model.getDepth(key2);\n  if (d1 === d2) {\n    if (isSibling(model, key1, key2)) return [key1, key2];\n    return getSiblingAncestorKeys(\n      model,\n      model.getParentKey(key1),\n      model.getParentKey(key2)\n    );\n  }\n  return d1 > d2\n    ? getSiblingAncestorKeys(\n        model,\n        getAncestorKeyByDepth(model, key1, d2),\n        key2\n      )\n    : getSiblingAncestorKeys(\n        model,\n        key1,\n        getAncestorKeyByDepth(model, key2, d1)\n      );\n}\n\n/**\n * 获取从subKey1到subKey2之间的subKeys,前提是 subKey1和subKey2的父亲相同\n * @param model\n * @param subKey1\n * @param subKey2\n */\nexport function getRangeSubKeys(\n  model: SheetModel,\n  subKey1: KeyType,\n  subKey2: KeyType\n): Array<KeyType> {\n  const topic = model.getParentTopic(subKey1);\n  const subKeys = topic.subKeys;\n  const i1 = subKeys.indexOf(subKey1);\n  const i2 = subKeys.indexOf(subKey2);\n  if (i1 < 0 || i2 < 0)\n    throw new Error(\n      `The parent of subKey1 ${subKey1} and subKey2 ${subKey2} is not same`\n    );\n  return (i1 < i2\n    ? subKeys.slice(i1, i2 + 1)\n    : subKeys.slice(i2, i1 + 1)\n  ).toArray();\n}\n\n/**\n * 获取最底层最下面的后代的Key, 如果该项没有子元素，则返回自己的key\n * @param model\n * @param key\n */\nexport function getBottomDescendantKey(\n  model: SheetModel,\n  key: KeyType\n): KeyType {\n  const topic = model.getTopic(key);\n  return topic.subKeys.size === 0\n    ? key\n    : //@ts-ignore\n      getBottomDescendantKey(model, topic.subKeys.last());\n}\n\n/**\n * 获取最底层最下面的后代的Key, 需要考虑折叠, 如果该项没有子元素，则返回自己的key\n * @param model\n * @param key\n */\nexport function getVisualBottomDescendantKey(\n  model: SheetModel,\n  key: KeyType\n): KeyType {\n  const topic = model.getTopic(key);\n  return topic.subKeys.size === 0 || topic.collapse\n    ? key\n    : //@ts-ignore\n      getVisualBottomDescendantKey(model, topic.subKeys.last());\n}\n\n/**\n * 是否都是Sibiling\n * @param model\n * @param keys\n */\nexport function isAllSibiling(model: SheetModel, keys: Array<KeyType>) {\n  if (keys && keys.length > 0) {\n    const parentKey = model.getParentKey(keys[0]);\n    for (const key of keys) {\n      if (model.getParentKey(key) !== parentKey) return false;\n    }\n    return true;\n  }\n  return false;\n}\n","export function createKey() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = (Math.random() * 16) | 0,\n      v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n","import debug from 'debug';\nimport htmlToText from 'html-to-text';\nimport { List } from 'immutable';\nimport { ThemeType } from '../configs/theme';\nimport {\n  BlockType,\n  DiagramLayoutType,\n  FocusMode,\n  KeyType,\n  TopicRelationship\n} from '../types';\nimport { createKey } from '../utils';\nimport { Block } from './block';\nimport { Config, ConfigRecordType } from './config';\nimport { DescBlockData } from './desc-block-data';\nimport { SheetModel } from './sheet-model';\nimport { Topic } from './topic';\nimport {\n  getAllSubTopicKeys,\n  getKeyPath,\n  getPrevTopicKey,\n  getRelationship\n} from './utils';\n\nconst log = debug('modifier');\n\ntype ModifierArg =\n  | BaseSheetModelModifierArg\n  | SetTopicArg\n  | setTopicBlockDataArg\n  | SetFocusModeArg\n  | SetTopicStyleArg\n  | SetZoomFactorArg\n  | SetThemeArg\n  | SetLayoutDirArg\n  | SetConfigArg;\n\nexport type BaseSheetModelModifierArg = {\n  model: SheetModel;\n  topicKey?: KeyType;\n  topicKeys?: Array<KeyType>;\n};\n\ntype SetTopicArg = BaseSheetModelModifierArg & {\n  topic: Topic;\n};\n\ntype setTopicBlockDataArg = BaseSheetModelModifierArg & {\n  blockType: string;\n  data: any;\n  focusMode?: string;\n};\n\ntype DeleteTopicBlockArg = BaseSheetModelModifierArg & {\n  blockType: string;\n};\n\ntype SetFocusModeArg = BaseSheetModelModifierArg & {\n  focusMode: string;\n};\n\ntype SetTopicStyleArg = BaseSheetModelModifierArg & {\n  style: string;\n};\n\ntype SetZoomFactorArg = BaseSheetModelModifierArg & {\n  zoomFactor: number;\n};\n\ntype SetThemeArg = BaseSheetModelModifierArg & {\n  theme: ThemeType;\n};\n\ntype SetLayoutDirArg = BaseSheetModelModifierArg & {\n  layoutDir: DiagramLayoutType;\n};\n\ntype SetConfigArg = BaseSheetModelModifierArg & {\n  config: Partial<ConfigRecordType>;\n};\n\nexport type SheetModelModifierResult = SheetModel;\n\nfunction toggleCollapse({\n  model,\n  topicKey\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  let topic = model.getTopic(topicKey);\n  if (topic && topic.subKeys.size !== 0) {\n    topic = topic.merge({\n      collapse: !topic.collapse\n    });\n    model = model.updateIn(\n      ['topics', topic.key, 'collapse'],\n      collapse => !collapse\n    );\n  }\n  model = focusTopic({ model, topicKey, focusMode: FocusMode.NORMAL });\n  return model;\n}\n\nfunction collapseAll({\n  model\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  const topicKeys = getAllSubTopicKeys(model, model.editorRootTopicKey);\n  log(model);\n  model = model.withMutations(m => {\n    topicKeys.forEach(topicKey => {\n      m.setIn(['topics', topicKey, 'collapse'], true);\n    });\n  });\n  model = focusTopic({\n    model,\n    topicKey: model.editorRootTopicKey,\n    focusMode: FocusMode.NORMAL\n  });\n  return model;\n}\n\nfunction expandAll({\n  model\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  const topicKeys = getAllSubTopicKeys(model, model.editorRootTopicKey);\n  log(model);\n  model = model.withMutations(m => {\n    topicKeys.forEach(topicKey => {\n      m.setIn(['topics', topicKey, 'collapse'], false);\n    });\n  });\n  log(model);\n  return model;\n}\n\nfunction expandTo({\n  model,\n  topicKey\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  const keys = getKeyPath(model, topicKey).filter(t => t !== topicKey);\n  model = model.withMutations(m => {\n    keys.forEach(topicKey => {\n      m.setIn(['topics', topicKey, 'collapse'], false);\n    });\n  });\n  // 要让这个节点在视口中可见\n  if (\n    getRelationship(model, topicKey, model.editorRootTopicKey) !==\n    TopicRelationship.DESCENDANT\n  ) {\n    model = model.set('editorRootTopicKey', model.rootTopicKey);\n  }\n  return model;\n}\n\nfunction focusTopic({\n  model,\n  topicKey,\n  focusMode = FocusMode.NORMAL\n}: SetFocusModeArg): SheetModelModifierResult {\n  log('focus topic', focusMode);\n  if (!model.topics.has(topicKey)) {\n    throw new Error(`focus key ${topicKey} is not in model`);\n  }\n  if (topicKey !== model.focusKey) model = model.set('focusKey', topicKey);\n  // if (focusMode !== model.focusMode) model = model.set('focusMode', focusMode);\n  model = model.set('focusMode', focusMode);\n  if (model.selectedKeys != null) model = model.set('selectedKeys', null);\n  return model;\n}\n\nfunction setFocusMode({\n  model,\n  focusMode\n}: SetFocusModeArg): SheetModelModifierResult {\n  log('setFocusMode');\n  // SHOW_POPUP一定要重新设置, 因为可能dialogType 改变了\n  if (focusMode !== model.focusMode || focusMode === FocusMode.SHOW_POPUP)\n    model = model.set('focusMode', focusMode);\n  return model;\n}\n\nfunction addChild({\n  model,\n  topicKey,\n  addAtFront = false\n}: BaseSheetModelModifierArg & {\n  addAtFront: boolean;\n}): SheetModelModifierResult {\n  log('addChild:', topicKey);\n  let topic = model.getTopic(topicKey);\n  if (topic) {\n    const child = Topic.create({ key: createKey(), parentKey: topic.key });\n    topic = topic\n      .set('collapse', false)\n      .update('subKeys', subKeys =>\n        addAtFront ? subKeys.unshift(child.key) : subKeys.push(child.key)\n      );\n    model = model.update('topics', topics =>\n      topics.set(topicKey, topic).set(child.key, child)\n    );\n    return focusTopic({\n      model,\n      topicKey: child.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction addSibling({\n  model,\n  topicKey,\n  content\n}: BaseSheetModelModifierArg & {\n  content?: string;\n}): SheetModelModifierResult {\n  if (topicKey === model.rootTopicKey) return model;\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const pItem = model.getTopic(topic.parentKey);\n    const idx = pItem.subKeys.indexOf(topicKey);\n    const sibling = Topic.create({\n      key: createKey(),\n      parentKey: pItem.key,\n      content\n    });\n    model = model\n      .update('topics', topics => topics.set(sibling.key, sibling))\n      .updateIn(['topics', pItem.key, 'subKeys'], subKeys =>\n        subKeys.insert(idx + 1, sibling.key)\n      );\n    return focusTopic({\n      model,\n      topicKey: sibling.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction topicContentToPlainText({\n  model,\n  topicKey\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  const content = model.getTopic(topicKey).getBlock(BlockType.CONTENT).block\n    .data;\n  const data = htmlToText.fromString(content, { preserveNewlines: true });\n  return setTopicBlockContentData({ model, topicKey, data });\n}\n\nfunction deleteTopic({\n  model,\n  topicKey\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  if (topicKey === model.editorRootTopicKey) return model;\n  const item = model.getTopic(topicKey);\n  if (item) {\n    model = model.withMutations(m => {\n      m.update('topics', topics => {\n        topics = topics.delete(topicKey);\n        const deleteKeys = getAllSubTopicKeys(model, topicKey);\n        topics = topics.withMutations(t => {\n          deleteKeys.forEach(dKey => {\n            t.delete(dKey);\n          });\n        });\n        return topics;\n      });\n      m.updateIn(['topics', item.parentKey, 'subKeys'], subKeys =>\n        subKeys.delete(subKeys.indexOf(topicKey))\n      );\n      if (m.focusKey === topicKey)\n        m.set('focusKey', getPrevTopicKey(model, topicKey)).set(\n          'focusMode',\n          FocusMode.EDITING_CONTENT\n        );\n    });\n  }\n\n  return model;\n}\n\nfunction deleteTopics({ model, topicKeys }): SheetModelModifierResult {\n  if (topicKeys == null) topicKeys = model.focusOrSelectedKeys;\n  topicKeys.forEach(topicKey => {\n    model = deleteTopic({ model, topicKey });\n  });\n  return model;\n}\n\n/**\n * setTopicBlockData of one topic\n * @param model\n * @param topicKey\n * @param blockType\n * @param focusMode\n * @param data\n */\nfunction setTopicBlockData({\n  model,\n  topicKey,\n  blockType,\n  focusMode,\n  data\n}: setTopicBlockDataArg): SheetModelModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const { index, block } = topic.getBlock(blockType);\n    if (index === -1) {\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\n        blocks.push(\n          Block.create({\n            type: blockType,\n            data: data\n          })\n        )\n      );\n    } else {\n      if (block.data !== data) {\n        model = model.updateIn(\n          ['topics', topicKey, 'blocks', index, 'data'],\n          dt => data\n        );\n      }\n    }\n    if (focusMode) {\n      model = focusTopic({\n        model,\n        topicKey,\n        focusMode\n      });\n    }\n  }\n  return model;\n}\n\nfunction setTopicBlockContentData({\n  model,\n  topicKey,\n  focusMode = null,\n  data\n}): SheetModelModifierResult {\n  return setTopicBlockData({\n    model,\n    topicKey,\n    focusMode,\n    data,\n    blockType: BlockType.CONTENT\n  });\n}\n\nfunction deleteTopicBlock({ model, topicKey, blockType }: DeleteTopicBlockArg) {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const { index } = topic.getBlock(blockType);\n    if (index !== -1) {\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\n        blocks.delete(index)\n      );\n    }\n    model = setFocusMode({\n      model,\n      focusMode: FocusMode.NORMAL\n    });\n  }\n  return model;\n}\n\nfunction deleteTopicBlockDesc({ model, topicKey }: BaseSheetModelModifierArg) {\n  return deleteTopicBlock({ model, topicKey, blockType: BlockType.DESC });\n}\n\nfunction setStyle({\n  model,\n  topicKey,\n  style\n}: SetTopicStyleArg): SheetModelModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    if (style !== topic.style) {\n      model = model.updateIn(['topics', topicKey, 'style'], s => style);\n    }\n  }\n  return model;\n}\n\nfunction clearAllCustomStyle({\n  model\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  model = model.withMutations(model => {\n    model.topics.keySeq().forEach(key => {\n      model.setIn(['topics', key, 'style'], null);\n    });\n  });\n  return model;\n}\n\nfunction setTheme({ model, theme }: SetThemeArg): SheetModelModifierResult {\n  model = model.setIn(['config', 'theme'], theme);\n  return model;\n}\n\nfunction setLayoutDir({\n  model,\n  layoutDir\n}: SetLayoutDirArg): SheetModelModifierResult {\n  if (model.config.layoutDir === layoutDir) return model;\n  model = model.setIn(['config', 'layoutDir'], layoutDir);\n  return model;\n}\n\nfunction setConfig({ model, config }: SetConfigArg) {\n  return model.set('config', model.config.merge(config));\n}\n\nfunction setEditorRootTopicKey({\n  model,\n  topicKey\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  if (model.editorRootTopicKey !== topicKey)\n    model = model.set('editorRootTopicKey', topicKey);\n  if (model.getTopic(topicKey).collapse)\n    model = model.setIn(['topics', topicKey, 'collapse'], false);\n  return model;\n}\n\nfunction setZoomFactor({\n  model,\n  zoomFactor\n}: SetZoomFactorArg): SheetModelModifierResult {\n  if (model.zoomFactor !== zoomFactor)\n    model = model.set('zoomFactor', zoomFactor);\n  return model;\n}\n\nfunction startEditingContent({ model, topicKey }: BaseSheetModelModifierArg) {\n  return focusTopic({\n    model,\n    topicKey,\n    focusMode: FocusMode.EDITING_CONTENT\n  });\n}\nfunction startEditingDesc({ model, topicKey }: BaseSheetModelModifierArg) {\n  const topic = model.getTopic(topicKey);\n  const desc = topic.getBlock(BlockType.DESC);\n  if (desc.block == null || desc.block.data == null) {\n    model = SheetModelModifier.setTopicBlockData({\n      model,\n      topicKey,\n      blockType: BlockType.DESC,\n      data: new DescBlockData({ kind: 'html', data: '', collapse: false })\n    });\n  }\n  model = SheetModelModifier.focusTopic({\n    model,\n    topicKey,\n    focusMode: FocusMode.EDITING_DESC\n  });\n  return model;\n}\n\nfunction dragAndDrop({ model, srcKey, dstKey, dropDir }) {\n  const srcTopic = model.getTopic(srcKey);\n  const dstTopic = model.getTopic(dstKey);\n\n  const srcParentKey = srcTopic.parentKey;\n  const srcParentTopic = model.getTopic(srcParentKey);\n  let srcParentSubKeys = srcParentTopic.subKeys;\n  const srcIndex = srcParentSubKeys.indexOf(srcKey);\n\n  srcParentSubKeys = srcParentSubKeys.delete(srcIndex);\n\n  if (dropDir === 'in') {\n    let dstSubKeys = dstTopic.subKeys;\n    dstSubKeys = dstSubKeys.push(srcKey);\n    model = model.withMutations(m => {\n      m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys)\n        .setIn(['topics', srcKey, 'parentKey'], dstKey)\n        .setIn(['topics', dstKey, 'subKeys'], dstSubKeys)\n        .setIn(['topics', dstKey, 'collapse'], false);\n    });\n  } else {\n    const dstParentKey = dstTopic.parentKey;\n    const dstParentItem = model.getTopic(dstParentKey);\n    let dstParentSubKeys = dstParentItem.subKeys;\n    const dstIndex = dstParentSubKeys.indexOf(dstKey);\n    //src 和 dst 的父亲相同，这种情况要做特殊处理\n    if (srcParentKey === dstParentKey) {\n      let newDstParentSubKeys = List();\n      dstParentSubKeys.forEach(key => {\n        if (key !== srcKey) {\n          if (key === dstKey) {\n            if (dropDir === 'prev') {\n              newDstParentSubKeys = newDstParentSubKeys.push(srcKey).push(key);\n            } else {\n              newDstParentSubKeys = newDstParentSubKeys.push(key).push(srcKey);\n            }\n          } else {\n            newDstParentSubKeys = newDstParentSubKeys.push(key);\n          }\n        }\n      });\n      model = model.withMutations(m => {\n        m.setIn(['topics', dstParentKey, 'subKeys'], newDstParentSubKeys);\n      });\n    } else {\n      if (dropDir === 'prev') {\n        dstParentSubKeys = dstParentSubKeys.insert(dstIndex, srcKey);\n      } else if (dropDir === 'next') {\n        dstParentSubKeys = dstParentSubKeys.insert(dstIndex + 1, srcKey);\n      }\n      model = model.withMutations(m => {\n        m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys)\n          .setIn(['topics', srcKey, 'parentKey'], dstParentKey)\n          .setIn(['topics', dstParentKey, 'subKeys'], dstParentSubKeys)\n          .setIn(['topics', dstParentKey, 'collapse'], false);\n      });\n    }\n  }\n  return model;\n}\n\nfunction swapUp({\n  model,\n  topicKeys\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  if (topicKeys == null) topicKeys = model.focusOrSelectedKeys;\n  const firstKey = topicKeys[0];\n  const parent = model.getParentTopic(firstKey);\n  const idxArray = [];\n\n  for (const itemKey of topicKeys) {\n    const idx = parent.subKeys.indexOf(itemKey);\n    // 如果topicKeys不是sibling 关系\n    if (idx === -1) return model;\n    idxArray.push(idx);\n  }\n  // 对序号进行排序\n  idxArray.sort((a, b) => a - b);\n\n  const firstIdx = idxArray[0];\n  if (firstIdx === 0) {\n    return model;\n  } else {\n    const sortedItemKeys = idxArray.map(idx => parent.subKeys.get(idx));\n    model = model.updateIn(['topics', parent.key, 'subKeys'], subKeys =>\n      subKeys\n        .splice(idxArray[0], idxArray.length)\n        .splice(idxArray[0] - 1, 0, ...sortedItemKeys)\n    );\n  }\n  return model;\n}\n\nfunction swapDown({\n  model,\n  topicKeys\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\n  if (topicKeys == null) topicKeys = model.focusOrSelectedKeys;\n  const firstKey = topicKeys[0];\n  const parent = model.getParentTopic(firstKey);\n  const idxArray = [];\n\n  for (const itemKey of topicKeys) {\n    const idx = parent.subKeys.indexOf(itemKey);\n    if (idx === -1) return model;\n    idxArray.push(idx);\n  }\n  idxArray.sort((a, b) => a - b);\n\n  const lastIdx = idxArray[idxArray.length - 1];\n  if (lastIdx === parent.subKeys.size - 1) {\n    return model;\n  } else {\n    const sortedItemKeys = idxArray.map(idx => parent.subKeys.get(idx));\n    model = model.updateIn(['topics', parent.key, 'subKeys'], subKeys =>\n      subKeys\n        .splice(idxArray[0], idxArray.length)\n        .splice(idxArray[0] + 1, 0, ...sortedItemKeys)\n    );\n  }\n  return model;\n}\n\nfunction addMultiSibling({\n  model,\n  topicKey,\n  contentArray,\n  topicArray\n}: BaseSheetModelModifierArg & {\n  contentArray?: string[];\n  topicArray?: Array<Topic>;\n}) {\n  const topic = model.getTopic(topicKey);\n  const parentKey = topic.parentKey;\n  const parentTopic = model.getTopic(parentKey);\n  const idx = parentTopic.subKeys.indexOf(topicKey);\n  if (contentArray) {\n    const siblings = contentArray.map(content =>\n      Topic.create({\n        key: createKey(),\n        parentKey,\n        content\n      })\n    );\n    const siblingsKeys = siblings.map(s => s.key);\n    model = model.withMutations(model => {\n      siblings.forEach(sibling => {\n        model.update('topics', topics => topics.set(sibling.key, sibling));\n      });\n      model.updateIn(['topics', parentKey, 'subKeys'], subKeys =>\n        subKeys.splice(idx + 1, 0, ...siblingsKeys)\n      );\n    });\n    model = focusTopic({\n      model,\n      topicKey: siblingsKeys[siblingsKeys.length - 1],\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  } else if (topicArray) {\n  }\n  return model;\n}\n\nfunction addMultiChild({\n  model,\n  topicKey,\n  addAtFront = false,\n  contentArray,\n  topicArray\n}: BaseSheetModelModifierArg & {\n  addAtFront?: boolean;\n  contentArray?: string[];\n  topicArray?: Array<Topic>;\n}) {\n  if (contentArray) {\n    topicArray = contentArray.map(content =>\n      Topic.create({\n        key: createKey(),\n        parentKey: topicKey,\n        content\n      })\n    );\n  }\n\n  const childKeys = topicArray\n    .filter(s => s.parentKey === topicKey)\n    .map(s => s.key);\n  model = model.withMutations(model => {\n    topicArray.forEach(topic => {\n      model.update('topics', topics_ => topics_.set(topic.key, topic));\n    });\n    model.updateIn(['topics', topicKey, 'subKeys'], subKeys =>\n      addAtFront ? subKeys.unshift(...childKeys) : subKeys.push(...childKeys)\n    );\n  });\n  model = focusTopic({\n    model,\n    topicKey: childKeys[childKeys.length - 1],\n    focusMode: FocusMode.EDITING_CONTENT\n  });\n  return model;\n}\n\nfunction addMultiTopics({ model, topics }) {\n  model = model.withMutations(model => {\n    topics.forEach(topic => {\n      model.update('topics', topics_ => topics_.set(topic.key, topic));\n    });\n  });\n  return model;\n}\n\nexport const SheetModelModifier = {\n  addChild,\n  addSibling,\n  addMultiTopics,\n  addMultiChild,\n  addMultiSibling,\n  toggleCollapse,\n  collapseAll,\n  expandAll,\n  expandTo,\n  focusTopic,\n  topicContentToPlainText,\n  setFocusMode,\n  deleteTopic,\n  deleteTopics,\n  setTopicBlockData,\n  setTopicBlockContentData,\n  deleteTopicBlock,\n  setStyle,\n  clearAllCustomStyle,\n  setConfig,\n  setTheme,\n  setLayoutDir,\n  setEditorRootTopicKey,\n  setZoomFactor,\n  startEditingContent,\n  startEditingDesc,\n  dragAndDrop,\n  swapUp,\n  swapDown\n};\n","import debug from 'debug';\n\nimport { KeyType } from '../types';\nimport { DocModel } from './doc-model';\nimport { SheetModel } from './sheet-model';\nimport { SheetModelModifier } from './sheet-model-modifier';\n\nconst log = debug('modifier');\n\nexport type BaseDocModelModifierArg = {\n  docModel: DocModel;\n  //sheetModel是为了增删sheet使用的\n  sheetModel: SheetModel;\n  model?: SheetModel;\n  topicKey?: KeyType;\n};\n\ntype DocModelModifierResult = DocModel;\n\nexport function setCurrentSheetModel(\n  docModel: DocModel,\n  sheetModel: SheetModel\n): DocModel {\n  if (docModel.currentSheetModel !== sheetModel) {\n    docModel = docModel.updateIn(\n      ['sheetModels', docModel.currentSheetIndex],\n      m => sheetModel\n    );\n  }\n  return docModel;\n}\n\nexport function toDocModelModifierFunc(sheetModelModifierFunc) {\n  return arg => {\n    const { docModel, ...rest } = arg;\n    return setCurrentSheetModel(\n      docModel,\n      sheetModelModifierFunc({ ...rest, model: docModel.currentSheetModel })\n    );\n  };\n}\n\nfunction addSheet({\n  docModel,\n  sheetModel\n}: BaseDocModelModifierArg): DocModelModifierResult {\n  docModel = docModel.update('sheetModels', sheetModels =>\n    sheetModels.push(sheetModel)\n  );\n  docModel = docModel.set('currentSheetIndex', docModel.sheetModels.size - 1);\n  return docModel;\n}\n\nfunction setCurrentSheet({\n  docModel,\n  sheetIndex = null,\n  sheetModel = null,\n  sheetId = null\n}: BaseDocModelModifierArg & { sheetIndex?: number; sheetId?: KeyType }) {\n  if (sheetIndex != null && sheetModel != null) {\n    throw new Error('index and sheetModel both not null');\n  }\n  if (sheetIndex != null && docModel.currentSheetIndex !== sheetIndex) {\n    if (sheetIndex >= 0 && sheetIndex < docModel.sheetModels.size) {\n      docModel = docModel.set('currentSheetIndex', sheetIndex);\n    }\n  } else if (sheetModel != null) {\n    const idx = docModel.sheetModels.indexOf(sheetModel);\n    if (idx === -1) {\n      throw new Error('sheetModel is not in docModel');\n    }\n    docModel = docModel.set('currentSheetIndex', idx);\n  } else if (sheetId) {\n    const idx = docModel.getSheetIndex(sheetId);\n    if (idx === -1) {\n      throw new Error('sheetModel is not in docModel');\n    }\n    docModel = docModel.set('currentSheetIndex', idx);\n  }\n  return docModel;\n}\n\nfunction duplicateSheet({\n  docModel,\n  sheetModel,\n  title\n}: BaseDocModelModifierArg & { title: string }) {\n  const idx = docModel.sheetModels.indexOf(sheetModel);\n  if (idx === -1) {\n    throw new Error('sheetModel is not in docModel');\n  }\n  docModel = docModel\n    .update('sheetModels', sheetModels =>\n      sheetModels.insert(idx + 1, sheetModel.set('title', title))\n    )\n    .set('currentSheetIndex', idx + 1);\n  return docModel;\n}\n\nfunction deleteSheet({ docModel, sheetModel }: BaseDocModelModifierArg) {\n  const idx = docModel.sheetModels.indexOf(sheetModel);\n  if (idx === -1) {\n    throw new Error('sheetModel is not in docModel');\n  }\n  docModel = docModel\n    .update('sheetModels', sheetModels => sheetModels.delete(idx))\n    .set('currentSheetIndex', 0);\n  return docModel;\n}\n\nfunction setSheetTitle({ docModel, title }) {\n  docModel = docModel.updateIn(\n    ['sheetModels', docModel.currentSheetIndex],\n    sheetModel => sheetModel.set('title', title)\n  );\n  return docModel;\n}\n\nfunction addMultiChildWithExtData({\n  docModel,\n  topicKey,\n  addAtFront = false,\n  contentArray,\n  topicArray,\n  extData\n}) {\n  docModel = setCurrentSheetModel(\n    docModel,\n    SheetModelModifier.addMultiChild({\n      model: docModel.currentSheetModel,\n      topicKey,\n      addAtFront,\n      contentArray,\n      topicArray\n    })\n  );\n  if (extData) docModel = docModel.set('extData', extData);\n  return docModel;\n}\n\nconst DocModelModifier: any = {\n  addSheet,\n  setCurrentSheet,\n  duplicateSheet,\n  deleteSheet,\n  setSheetTitle,\n  addMultiChildWithExtData\n};\n\nObject.keys(SheetModelModifier).forEach(k => {\n  DocModelModifier[k] = toDocModelModifierFunc(SheetModelModifier[k]);\n});\n\nexport { DocModelModifier };\n","import { Map, Record } from 'immutable';\nimport isPlainObject from 'is-plain-object';\nimport { FocusMode, KeyType } from '../types';\nimport { createKey } from '../utils';\nimport { Config } from './config';\nimport { Topic } from './topic';\n\ntype ModelRecordType = {\n  id: KeyType;\n  title: string;\n  topics: Map<KeyType, Topic>;\n  config: Config;\n  rootTopicKey: KeyType;\n  editorRootTopicKey?: KeyType;\n  focusKey?: KeyType;\n  focusMode?: string;\n  selectedKeys?: Array<KeyType>;\n  zoomFactor: number;\n  formatVersion?: string;\n};\n\nconst defaultModelRecord: ModelRecordType = {\n  id: null,\n  title: null,\n  topics: Map(),\n  config: new Config(),\n  rootTopicKey: null,\n  editorRootTopicKey: null,\n  focusKey: null,\n  focusMode: null,\n  zoomFactor: 1,\n  selectedKeys: null,\n  formatVersion: null\n};\n\nexport class SheetModel extends Record(defaultModelRecord) {\n  static isModel(obj) {\n    return obj instanceof SheetModel;\n  }\n  static create(attrs: any = null): SheetModel {\n    if (attrs == null) return SheetModel.createEmpty();\n    let res: SheetModel;\n    if (SheetModel.isModel(attrs)) {\n      res = attrs;\n    }\n\n    if (isPlainObject(attrs)) {\n      res = SheetModel.fromJSON(attrs);\n    }\n    if (res) {\n      if (res.focusKey == null) {\n        res = res.set('focusKey', res.rootTopicKey);\n      }\n      if (res.focusMode == null) {\n        res = res.set('focusMode', FocusMode.NORMAL);\n      }\n      return res;\n    }\n\n    throw new Error(\n      `\\`Value.create\\` only accepts objects or values, but you passed it: ${attrs}`\n    );\n  }\n\n  static createEmpty(arg?): SheetModel {\n    const model = new SheetModel();\n    const rootTopic = Topic.create({ key: createKey(), content: 'RootTopic' });\n    return model\n      .set('id', createKey())\n      .update('topics', topics => topics.set(rootTopic.key, rootTopic))\n      .set('rootTopicKey', rootTopic.key)\n      .set('editorRootTopicKey', rootTopic.key)\n      .set('focusKey', rootTopic.key)\n      .set('focusMode', FocusMode.NORMAL)\n      .merge(arg);\n  }\n\n  static fromJSON(object) {\n    let model = new SheetModel();\n    const { topics = [], config = {}, rootTopicKey } = object;\n    let { editorRootTopicKey } = object;\n\n    if (editorRootTopicKey === undefined) editorRootTopicKey = rootTopicKey;\n\n    model = model.merge({\n      rootTopicKey,\n      editorRootTopicKey\n    });\n\n    model = model.withMutations(model => {\n      topics.forEach(topic => {\n        model.update('topics', topics =>\n          topics.set(topic.key, Topic.fromJSON(topic))\n        );\n      });\n      model.set('config', Config.fromJSON(config));\n    });\n\n    return model;\n  }\n\n  toJS() {\n    return {\n      id: this.id,\n      title: this.title,\n      rootTopicKey: this.rootTopicKey,\n      topics: Object.values(this.topics.toJS()),\n      config: this.config,\n      zoomFactor: this.zoomFactor\n    };\n  }\n\n  get id(): KeyType {\n    return this.get('id');\n  }\n\n  get title(): string {\n    return this.get('title');\n  }\n\n  get topics(): Map<KeyType, Topic> {\n    return this.get('topics');\n  }\n\n  get config(): Config {\n    return this.get('config');\n  }\n\n  get formatVersion(): string {\n    return this.get('formatVersion');\n  }\n\n  get rootTopicKey(): KeyType {\n    return this.get('rootTopicKey');\n  }\n\n  get editorRootTopicKey(): KeyType {\n    return this.get('editorRootTopicKey');\n  }\n\n  get focusKey(): KeyType {\n    return this.get('focusKey');\n  }\n\n  get focusMode(): string {\n    return this.get('focusMode');\n  }\n\n  get editingContentKey(): KeyType {\n    return [FocusMode.EDITING_CONTENT, FocusMode.SHOW_POPUP].includes(\n      this.focusMode\n    )\n      ? this.focusKey\n      : null;\n  }\n\n  get editingDescKey(): KeyType {\n    return this.focusMode === FocusMode.EDITING_DESC ? this.focusKey : null;\n  }\n\n  get selectedKeys(): Array<KeyType> {\n    return this.get('selectedKeys');\n  }\n\n  get focusOrSelectedKeys(): Array<KeyType> {\n    return this.selectedKeys || [this.focusKey];\n  }\n\n  getTopic(key: KeyType): Topic {\n    return this.topics.get(key);\n  }\n\n  getParentTopic(key: KeyType): Topic {\n    const topic = this.getTopic(key);\n    return topic.parentKey ? this.getTopic(topic.parentKey) : null;\n  }\n\n  getParentKey(key: KeyType): KeyType {\n    return this.getTopic(key).parentKey;\n  }\n\n  getPreviousSiblingKey(key: KeyType): KeyType {\n    const p = this.getParentTopic(key);\n    const index = p.subKeys.indexOf(key);\n    if (index === 0) return null;\n    return p.subKeys.get(index - 1);\n  }\n\n  getNextSiblingKey(key: KeyType): KeyType {\n    const p = this.getParentTopic(key);\n    const index = p.subKeys.indexOf(key);\n    if (index === p.subKeys.size - 1) return null;\n    return p.subKeys.get(index + 1);\n  }\n\n  getVisualDepth(key: KeyType): number {\n    let topic = this.getTopic(key);\n    let depth = 0;\n    while (topic && topic.key !== this.editorRootTopicKey) {\n      depth++;\n      topic = this.getParentTopic(topic.key);\n    }\n    return depth;\n  }\n\n  getDepth(key: KeyType) {\n    let topic = this.getTopic(key);\n    let depth = 0;\n    while (topic && topic.key !== this.rootTopicKey) {\n      depth++;\n      topic = this.getParentTopic(topic.key);\n    }\n    return depth;\n  }\n\n  get rootTopic() {\n    return this.getTopic(this.rootTopicKey);\n  }\n\n  get currentFocusTopic() {\n    return this.getTopic(this.focusKey);\n  }\n\n  // 暂时没有用到\n  get zoomFactor() {\n    return this.get('zoomFactor');\n  }\n\n  isEditorRootKey(topicKey: KeyType) {\n    return topicKey === this.editorRootTopicKey;\n  }\n}\n","import { List, Map, Record } from 'immutable';\nimport { KeyType } from '../types';\nimport { SheetModel } from './sheet-model';\n\nexport type ExtData = Map<string, any>;\n\ntype DocRecordType = {\n  sheetModels: List<SheetModel>;\n  // 用于插件做扩展\n  extData: ExtData;\n  currentSheetIndex: number;\n  formatVersion: string;\n};\n\nconst defaultDocRecord: DocRecordType = {\n  sheetModels: List(),\n  extData: Map(),\n  currentSheetIndex: -1,\n  formatVersion: '0.1'\n};\n\nexport class DocModel extends Record(defaultDocRecord) {\n  get sheetModels(): List<SheetModel> {\n    return this.get('sheetModels');\n  }\n\n  get currentSheetIndex(): number {\n    return this.get('currentSheetIndex');\n  }\n\n  get formatVersion(): string {\n    return this.get('formatVersion');\n  }\n\n  static createEmpty() {\n    return new DocModel({\n      sheetModels: List([SheetModel.createEmpty()]),\n      currentSheetIndex: 0\n    });\n  }\n\n  get currentSheetModel(): SheetModel {\n    return this.sheetModels.get(this.currentSheetIndex);\n  }\n\n  get extData(): ExtData {\n    return this.get('extData');\n  }\n\n  getSheetModel(sheetId: string): SheetModel {\n    return this.sheetModels.find(s => s.id === sheetId);\n  }\n\n  getSheetIndex(sheetModel: SheetModel | KeyType) {\n    return sheetModel instanceof SheetModel\n      ? this.sheetModels.indexOf(sheetModel)\n      : this.sheetModels.findIndex(s => s.id === sheetModel);\n  }\n\n  getExtDataItem<T>(key: string, c: new () => T): T {\n    return this.extData.get(key) || new c();\n  }\n\n  getSheetIdThatContainsTopic(topicKey: KeyType) {\n    const sheet: SheetModel = this.sheetModels.find(s =>\n      s.topics.has(topicKey)\n    );\n    return sheet ? sheet.id : null;\n  }\n}\n","export function CorePlugin(options: any = {}) {\n  const { plugins = [] } = options;\n  return [...plugins];\n}\n","import debug from 'debug';\nimport memoizeOne from 'memoize-one';\nimport warning from 'tiny-warning';\nimport { DocModel, SheetModel } from './models';\nimport { CorePlugin } from './plugins/core';\nimport { ModelChangeCallback, OnChangeFunction } from './types';\n\nconst log = debug('core:controller');\n\nexport interface IControllerOption {\n  plugins?: Array<any>;\n  docModel?: DocModel;\n  readOnly?: boolean;\n  onChange?: OnChangeFunction;\n}\n\nexport interface IControllerRunContext {\n  controller: Controller;\n  docModel?: DocModel;\n  model?: SheetModel;\n  topicKey?: KeyType;\n  getRef?: Function;\n}\n\nexport interface IDiagram {\n  getDiagramProps(): IDiagramProps;\n  openNewDocModel(newModel: DocModel);\n}\n\nexport interface IDiagramProps {\n  docModel: DocModel;\n  controller: Controller;\n}\n\nfunction registerPlugin(controller: Controller, plugin: any) {\n  if (Array.isArray(plugin)) {\n    plugin.forEach(p => registerPlugin(controller, p));\n    return;\n  }\n\n  if (plugin == null) {\n    return;\n  }\n\n  for (const key in plugin) {\n    const fn = plugin[key];\n    controller.middleware[key] = controller.middleware[key] || [];\n    controller.middleware[key].push(fn);\n  }\n}\n\n// modified from koa-compose\nfunction compose(middleware) {\n  if (!Array.isArray(middleware))\n    throw new TypeError('Middleware stack must be an array!');\n  for (const fn of middleware) {\n    if (typeof fn !== 'function')\n      throw new TypeError('Middleware must be composed of functions!');\n  }\n\n  return function(context, next) {\n    // last called middleware #\n    let index = -1;\n    return dispatch(0);\n    function dispatch(i) {\n      if (i <= index) throw new Error('next() called multiple times');\n      index = i;\n      let fn = middleware[i];\n      if (i === middleware.length) fn = next;\n      if (!fn) return null;\n      try {\n        return fn(context, dispatch.bind(null, i + 1));\n      } catch (err) {\n        throw err;\n      }\n    }\n  };\n}\n\nexport class Controller {\n  middleware: Map<string, Function[]>;\n  private readonly onChange: OnChangeFunction;\n  public readOnly: boolean;\n  public docModel: DocModel;\n\n  get model() {\n    return this.docModel.currentSheetModel;\n  }\n\n  constructor(options: IControllerOption = {}) {\n    const { plugins = [], onChange, readOnly } = options;\n    this.readOnly = readOnly;\n    this.onChange = onChange;\n    this.middleware = new Map();\n    const corePlugin = CorePlugin({ plugins });\n    registerPlugin(this, corePlugin);\n  }\n\n  run(key: string, arg?) {\n    try {\n      const { middleware } = this;\n      const fns = middleware[key] || [];\n      warning(fns.length !== 0, `the middleware function ${key} is not found!`);\n      const composedFn = memoizeOne(compose)(fns);\n      // @ts-ignore\n      return composedFn(arg);\n    } catch (e) {\n      this.run('captureError', { error: e });\n    }\n  }\n\n  getValue(propKey: string, arg?) {\n    return this.run('getValue', { ...arg, propKey });\n  }\n\n  change(model: DocModel, callback?: ModelChangeCallback) {\n    log('change', model, model.currentSheetModel);\n    this.docModel = model;\n    this.onChange(model, callback);\n  }\n}\n"],"names":["log","Map"],"mappings":"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"}